name: Update README with gource video

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Update README with githack URL
        run: |
          OWNER="${GITHUB_REPOSITORY%%/*}"
          REPO="${GITHUB_REPOSITORY##*/}"
          BRANCH="main"
          FILE="gource.mp4"
          URL="https://raw.githack.com/$OWNER/$REPO/$BRANCH/$FILE"

          # Si quieres reemplazar entre markers:
          START="<!-- GOURCE-VIDEO-START -->"
          END="<!-- GOURCE-VIDEO-END -->"

          if grep -q "$START" README.md; then
            # Reemplazar contenido entre markers
            sed -i "/$START/,/$END/c\\$START\n[Ver gource.mp4]($URL)\n$END" README.md
          else
            # Agregar al final si no existen markers
            echo -e "\n$START\n[Ver gource.mp4]($URL)\n$END" >> README.md
          fi

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Update gource.mp4 link in README" || echo "No changes to commit"
          git push
